---
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";

const posts = (await getCollection("blog"))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<BaseLayout title="Blog â€” Omar Maaouane" description="Thoughts on engineering, infrastructure, and things I find interesting.">
  <section class="blog-index">
    <h1>Blog</h1>
    <p class="subtitle">Thoughts on engineering, infrastructure, and things I find interesting.</p>

    <ul class="post-list">
      {posts.map((post) => {
        const formattedDate = post.data.pubDate.toLocaleDateString("en-GB", {
          year: "numeric",
          month: "short",
          day: "numeric",
        });
        return (
          <li class="post-item">
            <a href={`/blog/${post.slug}/`}>
              <div class="post-info">
                <time datetime={post.data.pubDate.toISOString()}>
                  {formattedDate}
                </time>
                {post.data.tags.length > 0 && (
                  <div class="post-tags">
                    {post.data.tags.slice(0, 3).map((tag) => (
                      <span class="tag">#{tag}</span>
                    ))}
                  </div>
                )}
              </div>
              <h2>{post.data.title}</h2>
              <p>{post.data.description}</p>
            </a>
          </li>
        );
      })}
    </ul>

    {posts.length === 0 && (
      <p class="empty">No posts yet. Check back soon.</p>
    )}
  </section>
</BaseLayout>

<style>
  .blog-index h1 {
    font-size: 2rem;
    margin-bottom: 0.5rem;
  }

  .subtitle {
    color: var(--color-text-muted);
    font-size: 1.0625rem;
    margin-bottom: 2.5rem;
  }

  .post-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .post-item {
    margin-bottom: 0;
    border-bottom: 1px solid var(--color-border);
  }

  .post-item:first-child {
    border-top: 1px solid var(--color-border);
  }

  .post-item a {
    display: block;
    padding: 1.5rem 0;
    color: var(--color-text);
    transition: all var(--transition);
  }

  .post-item a:hover {
    color: var(--color-text);
  }

  .post-item a:hover h2 {
    color: var(--color-accent);
  }

  .post-info {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 0.375rem;
  }

  .post-info time {
    font-family: var(--font-mono);
    font-size: 0.8125rem;
    color: var(--color-text-muted);
  }

  .post-tags {
    display: flex;
    gap: 0.375rem;
  }

  .tag {
    font-family: var(--font-mono);
    font-size: 0.75rem;
    color: var(--color-accent);
    opacity: 0.7;
  }

  .post-item h2 {
    font-size: 1.25rem;
    font-weight: 600;
    margin: 0 0 0.375rem;
    transition: color var(--transition);
  }

  .post-item p {
    font-size: 0.9375rem;
    color: var(--color-text-muted);
    line-height: 1.5;
    margin: 0;
  }

  .empty {
    color: var(--color-text-muted);
    font-style: italic;
  }
</style>
